"use strict";var Phoenix=function(a){var b,c={},d=function(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b},e=function(){return d()+d(!0)+d(!0)+d()},f=function(){return"I"+d()+d()+d()+d()},g={},h=function(a){b=a},i=function(){return b},j=function(a,b){var c="on"+a,d=g[c];d&&d.forEach(function(a){var c=a.listener?a.handler.bind(a.listener):a.handler;c(b)})},k=function(a,b,c){g[a]=g[a]||[];var d=g[a];d.push({listener:c,handler:b})},l=function(a,b){function c(b){if(b)for(var c=b.length;c--;){var d=b[c];d.listener==a&&b.splice(c,1)}}b?c(g[b]):Object.keys(g).forEach(function(a){c(g[a])})},m=function(a,b){return a?a.id==b?a:a.querySelector("#"+b):document.getElementById(b)},n=function(a,b){a.classList.add(b)},o=function(a,b){a.classList.remove(b)},p=function(a,b){return a.classList.contains(b)},q=function(a){a.parentNode.removeChild(a)},r=function(a){return a.parentNode.removeChild(a)},s=function(a,b){a.appendChild(b)},t=function(a,b){a.parentNode.insertBefore(b,a)},u=function(){return a.Promise||a.ES6Promise.Promise},v=function(a){var b=u();return new b(function(b,c){$.ajax({url:a}).done(function(a){b(a)}).fail(function(a,b,d){c(d||{message:b})})})},w=function(a,b){var c=u();return new c(function(c,d){$.ajax({type:"PUT",contentType:"application/json",url:a,data:JSON.stringify(b)}).done(function(a){c(a)}).fail(function(a,b,c){d(c||{message:b})})})},x=function(a){var b=u();return new b(function(b,c){$.ajax({url:a,dataType:"script",cache:!0}).done(function(){b(!0)}).fail(function(a,b,d){c(d||{message:b})})})},y={},z=function(a,b,c){y[a]=y[a]||{},y[a][b]=c},A=function(a,b){return y[a]?y[a][b]:null},B=function(a,b){if(a){var c=a.split(" ");c.forEach(function(a){a=a.trim(),a&&"$"===a.charAt(0)&&(a="bs-style-"+a.substring(1)),b.push(a)})}},C=function(a,b){return void 0===b?a.textContent:void(a.textContent=b)},D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},E=function(a){return(a||"").replace(/[&<>"'\/]/g,function(a){return D[a]})};return c.render={register:z,get:A},c.utils={allocUuid:e,allocID:f,escapeHtml:E},c.drag={setData:h,getData:i},c.ipc={emit:j,listen:k,unlisten:l},c.dom={find:m,addClass:n,removeClass:o,hasClass:p,before:t,append:s,remove:q,detach:r,text:C},c.ajax={get:v,getScript:x,put:w},c.styles={parse:B},c}(this);this.Phoenix=Phoenix,function(a){var b={design:{Save:"Save",Preview:"Preview",AuthoringMode:"Authoring"},PanelTitle:"Panel title",Html:'<p class="text-primary text-center">Block Html</p>'};return a.locale=a.locale||{},a.locale.layouts=a.locale.layouts||b,a}(Phoenix),function(a){var b=a.locale.layouts,c=function(a,c,d,e){a.$id||(a.$id=d.allocID()),c&&(a.$parentId=c.$id),a.$idDesign=a.$id,a.$idDrag=a.$id,a.$type=a.$type||"block",a.$items=a.$items||[],e&&(e[a.$id]=a),"panel"!=a.$type||a.$title?"html"!=a.$type||a.$html||(a.$html=b.Html):a.$title=b.PanelTitle},d=function(a,b,c,d){a.$id||(a.$id=c.allocID()),b&&(a.$parentId=b.$id),a.$idDrag=a.$id,d&&(d[a.$id]=a)},e=function(a){a.$items.length||a.$items.push({});var b=!1;if(a.$items.forEach(function(a){a.$type="column",a.$colSize||(b=!0)}),b){var c=Math.max(1,Math.floor(12/a.$items.length));a.$items.forEach(function(a){a.$colSize=c})}},f=function(a){if("row"===a.$type||"accordion"===a.$type||"html"===a.$type)return!1;if(a.$items.length>0){var b=a.$items[0];if(!b.$items)return!1}return!0},g=function(a){return"panel"==a.$type},h=function(a){return g(a)},i=function(a){var b=!0;return a.$items.length&&g(a)?(a.$items.forEach(function(a){b&&(b=!h(a))}),b):b},j=function(a){if(a.$type&&!a.$items&&(a.$items=[]),"row"===a.$type||"accordion"===a.$type||"html"===a.$type)return!1;if(a.$items.length>0){var b=a.$items[0];if(b.$type||b.$items)return!1}return!0},k=function(b,c){a.styles.parse(b.$style,c)},l=function(a,b,c){var d,e=[];switch(a.$type){case"block":e.push("container-fluid"),c.design&&a.selected&&e.push("selected"),d=f(a),d&&((c.design||i(a))&&e.push("no-x-padding"),c.design&&e.push("drop-layouts-zone")),j(a)&&c.design&&(e.push("drop-fields-zone"),d||e.push("no-x-padding")),c.design&&(e.push("design"),a.selected&&e.push("selected")),k(a,e);break;case"accordion":1==c.step&&(e.push("panel-group"),c.design&&(e.push("design"),a.selected&&e.push("selected")),k(a,e));break;case"row":1==c.step?(e.push("container-fluid"),c.design&&(e.push("design"),e.push("no-x-padding"),a.selected&&e.push("selected")),k(a,e)):2==c.step&&(e.push("row"),c.design&&e.push("design-table"));break;case"panel":1==c.step?(e.push("panel"),e.push("panel-default"),c.design&&(e.push("design"),a.selected&&e.push("selected"))):2==c.step&&(e.push("panel-body"),d=f(a),d&&((c.design||i(a))&&(e.push("no-x-padding"),e.push("no-y-padding")),c.design&&e.push("drop-layouts-zone")),j(a)&&c.design&&(e.push("drop-fields-zone"),d||e.push("no-x-padding")),k(a,e));break;case"column":1==c.step?(e.push(c.design?"col-xs-"+a.$colSize:"col-"+(a.$colType||"sm")+"-"+a.$colSize),e.push("no-x-padding"),c.design&&e.push("drop-layouts-zone")):2==c.step&&(e.push("container-fluid"),d=f(a),d&&((c.design||i(a))&&e.push("no-x-padding"),c.design&&e.push("drop-layouts-zone")),j(a)&&c.design&&(e.push("drop-fields-zone"),d||e.push("no-x-padding")),c.design&&(e.push("design col"),a.selected&&e.push("selected")),k(a,e));break;case"html":c.design&&(e.push("design"),a.selected&&e.push("selected")),k(a,e)}return e},m=function(b,c,d,e){var f=l(c,d,e);if(b.className=f.join(" "),"panel"==c.$type&&1==e.step){var g=a.dom.find(b,c.$id+"_title");g&&a.dom.text(g,c.$title||"")}else"html"==c.$type&&1==e.step&&(b.innerHTML=c.$html||"")},n=function(a,b,c,d){var e=l(b,c,d);e.length&&(a.push(' class="'),a.push(e.join(" ")),a.push('"'))},o=function(a,b){a.push(' id="'),a.push(b.$id),a.push('"')},p=function(a,b,c){c&&(a.push(' data-level="'),a.push(b),a.push('"'))},q=function(a,b,c,d){if(d&&(a.push(' data-layout="'),a.push(c.$id),a.push('"')),d&&b>1){var e=c["$idStep"+b];e&&(a.push(' id="'),a.push(e),a.push('"'))}},r=function(a,b,c,d,e,f,g){a.push("<div"),g&&a.push(' draggable="true"'),n(a,b,c,{design:g,step:1}),q(a,1,b,g),o(a,b),a.push(">"),a.push('<div class="panel-heading"'),a.push(">"),a.push('<h4 class="panel-title" id="'+b.$id+'_title"'),a.push(">"),a.push(f.escapeHtml(b.$title)),a.push("</h4></div>"),b.$idStep2=b.$id+"_s2",b.$idDesign=b.$idStep2,a.push("<div"),n(a,b,c,{design:g,step:2}),q(a,2,b,g),p(a,2,g),a.push(">")},s=function(a,b){a.push("</div>"),b.$footer&&(a.push('<div class="panel-footer">'),a.push(b.$footer),a.push("</div>")),a.push("</div>")},t=function(a,b,c,d,e,f,g){a.push("<div"),g&&a.push(' draggable="true"'),n(a,b,c,{design:g,step:1}),q(a,1,b,g),o(a,b),p(a,1,g),a.push(">")},u=function(a){a.push("</div>")},v=function(a,b,c,d,e,f,g){a.push("<div"),g&&a.push(' draggable="true"'),n(a,b,c,{design:g,step:1}),q(a,1,b,g),o(a,b),p(a,1,g),a.push(">"),b.$html&&a.push(b.$html)},w=function(a){a.push("</div>")},x=function(a,b,c,d,f,g,h){a.push("<div"),h&&a.push(' draggable="true"'),n(a,b,c,{design:h,step:1}),o(a,b),q(a,1,b,h),p(a,1,h),a.push(">"),b.$idStep2=b.$id+"_s2",a.push("<div"),n(a,b,c,{design:h,step:2}),q(a,2,b,h),p(a,2,h),a.push(">"),e(b)},y=function(a){a.push("</div></div>")},z=function(a,b,c,d,e,f,g){a.push("<div"),n(a,b,c,{design:g,step:1}),q(a,1,b,g),o(a,b),p(a,1,g),a.push(">"),a.push("<div"),n(a,b,c,{design:g,step:2}),g&&a.push(' draggable="true"'),b.$idDesign=b.$id+"_design",b.$idDrag=b.$idDesign,b.$idStep2=b.$idDesign,q(a,2,b,g),p(a,2,g),a.push(">")},A=function(a){a.push("</div></div>")},B=function(a,b,c,d){if(a){if(d&&!a.$type&&!a.$items)return void c(a,b,!1,!0);c(a,b,!0,!0),j(a)?a.$items&&a.$items.forEach(function(b){c(b,a,!1,!0)}):a.$items&&a.$items.forEach(function(b){B(b,a,c,!1)}),c(a,b,!0,!1)}},C=function(a,b,c,d,e){a.push('<div class="bs-island'+(e.design?" design":"")+(b.$config?" bs-widget":" bs-field")+(b.selected?' selected"':'"')),e.design&&a.push(' draggable="true"'),a.push(' data-render="'+b.$id+'"'),a.push(' id="'+b.$id+'"'),a.push("></div>")},D=function(a,b){a.push('<div id="'+b.$id+'"></div>')},E=function(b,c,d,e,f,g){var h=a.render.get(g.context,"widget")||D,i=a.render.get(g.context,"field")||C;B(b,null,function(a,b,j,k){if(j){var l=t,m=u;switch(a.$type){case"row":l=x,m=y;break;case"column":l=z,m=A;break;case"panel":l=r,m=s;break;case"html":l=v,m=w}k?l(d,a,b,c,e,f,g.design):m(d,a,b,c,e,f,g.design)}else a.$config?h(d,a,b,c,g):i(d,a,b,c,g)},!0)},F=function(a,b,c){if(a.$type)return c=parseInt(c||"1",10),b&&a?"column"==b.$type&&"1"==c?b==a:"column"==a.$type?!1:!0:!1;if(a.$bind||a.$config){var d=b.$items.length;if(!d)return!0;for(var e=a.$bind?"$bind":"$config";d--;)if(!b.$items[d][e])return!1;return!0}return!1},G=function(a,b){return"column"==a.$type&&1==b?!1:!0};a.layout=a.layout||{};var H=a.layout;return H.utils=H.utils||{},H.utils.check=function(b,e,f,g){B(b,e,function(b,e,h,i){i&&(h?c(b,e,a.utils,f):d(b,e,a.utils,g))},!0)},H.utils.clearMeta=function(a,c){B(a,null,function(d,e,f,g){g&&(f?(c&&delete d.$id,delete d.$render,delete d.$idDesign,delete d.$idDrag,delete d.$parentId,delete d.$idStep2,"column"==d.$type?delete d.$type:"panel"==a.$type?a.$title==b.PanelTitle&&delete a.$title:"html"==a.$type&&a.$html==b.Html&&delete a.$html):(delete d.$render,c&&delete d.$id,delete d.$parentId,delete d.$idDrag))},!0)},H.utils.clearMaps=function(a,b,c){B(a,null,function(a,d,e,f){f&&(e?delete b[a.$id]:delete c[a.$id])},!0)},H.utils.afterRemoveChild=function(a,b,c){"row"==a.$type&&(a.$items.forEach(function(a){a.$type="column",delete a.$colSize}),e(a),a.$items.forEach(function(d){H.utils.check(d,a,b,c)}))},H.utils.canDropChild=F,H.utils.canSelect=G,H.utils.updateCssClass=m,H.toHtml=function(b,c,d){var e=[];return E(b,c,e,a.locale,a.utils,d),e.join("")},a}(Phoenix),function(a,b){var c=a.layout,d=function(a,b){this.$element=null,this.$content=null,this.options=b||{},this.options.context=this.options.context||"javascript",this.map={},this.mapFields={},a=a||{},c.utils.check(a,null,this.map,this.mapFields),this.data=a,a.map=this.map,a.fields=this.mapFields,this.children={},this._setDesignListeners()},e=function(a){for(var b=a.length;b--;)for(var c=a[b],d=Object.keys(c),e=d.length;e--;){var f=c[d[e]];if(f.selected)return f}return null},f={_setDesignListeners:function(){},_removeEvents:function(){},_addEvents:function(){},_onSelectedChanged:function(){},_showSelected:function(){},toString:function(){return null},_renderLayout:function(c){var d=this,e=b(a.layout.toHtml(c,null,{design:d.options.design,context:d.options.context}));return d._renderChildren(e),e},_renderChildren:function(c){var d=this,e=c.get(0),f=a.render.get(d.options.context,"widget.control"),g=a.render.get(d.options.context,"field.control");(f||g)&&Object.keys(d.mapFields).forEach(function(c){var h=d.mapFields[c],i=h.$config?f:g;if(i){var j=new i(h,{context:d.options.context,design:d.options.design,replaceParent:!0});j.render(b(a.dom.find(e,h.$id))),d.children[c]=j}})},_clearChildren:function(){var a=this,b=a.children;a.children={},Object.keys(b).forEach(function(a){b[a].destroy()})},_refreshSelected:function(){var a=this;if(a.options.design){var b=e([a.map,a.mapFields]);a._onSelectedChanged(a.$element.get(0),b,!0)}},render:function(a){var c=this;return c.$content?c.$element&&(c._clearChildren(),c._removeEvents(),c.options.beforeRemove&&c.options.beforeRemove(c.$element),c.$element.remove(),c.$element=null):c.$content=b("<div></div>"),c.$element||(c.$element=c._renderLayout(c.data),c.options.beforeAdd&&c.options.beforeAdd(c.$element),c.$content.append(c.$element),c._addEvents(),c._refreshSelected()),a&&(c.options.replaceParent?a.replaceWith(c.$content):a.append(c.$content)),c.$content},destroy:function(){var b=this;a.ipc.unlisten(b),b._clearChildren(),b.$element&&(b._removeEvents(),b.$element=null),b.map=null,b.mapFields=null,c.utils.clearMeta(b.data,!1)},check:function(b,c){var d=this;a.layout.utils.check(b,c,d.map,d.mapFields)},_afterStructureChanged:function(){var a=this;a.render()},_afterPropsChanged:function(b){var d=this;if(this.$element){var e=this.$element.get(0);if(e){var f=a.dom.find(e,b.$id),g=b.$id!=b.$idStep2?a.dom.find(e,b.$idStep2):null;f&&c.utils.updateCssClass(f,b,d.getLayoutById(b.$parentId),{design:d.options.design,step:1}),g&&c.utils.updateCssClass(g,b,d.getLayoutById(b.$parentId),{design:d.options.design,step:2}),b.selected&&d._refreshSelected()}}},removeChild:function(a){var b=this;if(a&&b.options.design){var d=b.map[a]||b.mapFields[a];if(d){var e=b.map[d.$parentId];if(e){var f=e.$items.indexOf(d);e.$items.splice(f,1),c.utils.clearMaps(d,this.map,this.mapFields),c.utils.afterRemoveChild(e,b.map,b.mapFields),b._afterStructureChanged(e)}}}},setDesignMode:function(a){var b=this;b.options.design!=a&&(b.options.design=a,b.render())},getLayoutById:function(a){if(!a)return null;var b=this;return b.map[a]},getFieldById:function(a){if(!a)return null;var b=this;return b.mapFields[a]},select:function(a){var b=this,c=b.$element;if(a&&b.options.design){var d=e([b.map,b.mapFields]);if(d&&(d.selected=!1,b._showSelected(c,d),b._onSelectedChanged(c.get(0),d,!1),d.$id==a))return void b._onSelectedChanged(c.get(0),null,!0);var f=b.map[a]?b.map[a]:b.mapFields[a];f.selected=!0,b._showSelected(c,f),b._onSelectedChanged(c.get(0),f,!0)}},updateField:function(a,b){var c=this,d=c.mapFields[a];d&&d.$render&&d.$config&&Object.keys(b.$config).forEach(function(a){"data"!=a&&d.$render[a]!=b.$config[a]&&(d.$render[a]=b.$config[a])})},updateLayout:function(a,b){var d=this,e=d.map[a],f=!1,g=!1;if(e){if(delete b.$type,delete b.selected,"row"==e.$type){if(b.$columns&&b.$columns!=e.$items.length){b.$columns>12&&(b.$columns=12);for(var h=e.$items.length;h<b.$columns;h++){var i={$items:[],$type:"column"};e.$items.push(i)}for(var h=b.$columns;h<e.$items.length;h++){var i=e.$items[h];c.utils.clearMaps(i,d.map,d.mapFields)}e.$items.splice(b.$columns,e.$items.length),c.utils.afterRemoveChild(e,d.map,d.mapFields),f=!0}delete b.$columns}d.disableRules=!0,Object.keys(b).forEach(function(a){b[a]!=e[a]&&(e[a]=b[a],g=!0)}),d.disableRules=!1,f?d._afterStructureChanged(e):g?d._afterPropsChanged(e):d._refreshSelected()}}};b.extend(d.prototype,f),a.ui=a.ui||{},a.ui.Layout=d}(Phoenix,$),function(a){var b=function(b,c){var d=b.$config,e=["bs-island bs-widget"];return a.styles.parse(d.$style,e),d.$border&&e.push("border"),c.design&&e.push("design"),b.$selected&&e.push("selected"),e.join(" ")},c=function(c,e,f){c.push('<div class="'),c.push(b(e,f)),c.push('"'),f.design&&c.push(' draggable="true"'),c.push(' data-render="'+e.$id+'"'),c.push(' id="'+e.$id+'"'),c.push(">"),d(c,e.$id,e.$config,f);var g=a.render.get(f.context,"widget.content");g&&g(c,e.$config,f)},d=function(b,c,d){b.push('<h4 class="bs-widget-title'+(d.$titleIsHidden?" bs-none":"")+'" id="'+c+'_title">'),b.push(a.utils.escapeHtml(d.$title)),b.push("</h4>")},e=function(a){a.push("</div>")},f=function(a,b,d,f,g){c(a,b,g),e(a)};return a.widget={toHtml:function(a,b,c,d){var e=[];return f(e,a,c,d,b),e.join("")}},a}(Phoenix),function(a,b){var c=function(b,c){this.item=b||{},this.item.$id||(this.item.$id=a.utils.allocID()),this.data=b.$config||{},b.$config.data=b.$config.data||{},this.props={},this.item.$render=this.props,this.props.data=b.$config.data,this.options=c||{},this.contentRender=null,this._defineProps()},d={_dp:function(a){var b=this;Object.defineProperty(b.props,a,{get:function(){return b.data[a]},set:function(c){c!=b.data[a]&&(b.data[a]=c,b._notifyChange(a))},enumerable:!0})},_defineProps:function(){var a=this;a._dp("$title"),a._dp("$border"),a._dp("$titleIsHidden")},_notifyChange:function(a){var b=this;switch(a){case"$title":b._updateTitle();break;case"$border":case"$titleIsHidden":b._updateCssClass()}},_updateTitle:function(){var b=this;if(b.$element){var c=a.dom.find(b.$element.get(0),b.item.$id+"_title");c&&a.dom.text(c,this.data.$title)}},_updateCssClass:function(){console.log("_updateCssClass")},render:function(d){var e=this;if(!e.$element){e.$element=b(a.widget.toHtml(e.item,e.options));var f=a.render.get(this.options.context,"widget.content.control."+e.data.$type,c);f&&(e.contentRender=new f(e.props,{context:e.options.context,replaceParent:!1}),e.contentRender.render(e.$element))}return d&&(e.options.beforeAdd&&e.options.beforeAdd(e.$element),e.options.replaceParent?d.replaceWith(e.$element):d.append(e.$element)),e.$element},destroy:function(){var a=this;a.contentRender&&(a.contentRender.destroy(),a.contentRender=null),this.item.$render=null,a.$element=null}};b.extend(c.prototype,d),a.ui=a.ui||{},a.ui.Widget=c,a.render.register("javascript","widget.control",c)}(Phoenix,$);