"use strict";var Phoenix=function(a){var b,c={},d=function(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b},e=function(){return d()+d(!0)+d(!0)+d()},f=function(){return"I"+d()+d()+d()+d()},g={},h=function(a){b=a},i=function(){return b},j=function(a){var b="on"+a,c=g[b];c&&c.forEach(function(a){var b=a.listener?a.handler.bind(a.listener):a.handler;b()})},k=function(a,b,c){g[a]=g[a]||[];var d=g[a];d.push({listener:c,handler:b})},l=function(a,b){function c(b){if(b)for(var c=b.length;c--;){var d=b[c];d.listener==a&&b.splice(c,1)}}b?c(g[b]):Object.keys(g).forEach(function(a){c(g[a])})},m=function(a,b){return a?a.id==b?a:a.querySelector("#"+b):document.getElementById(b)},n=function(a,b){a.classList.add(b)},o=function(a,b){a.classList.remove(b)},p=function(a,b){return a.classList.contains(b)},q=function(a){a.parentNode.removeChild(a)},r=function(a){return a.parentNode.removeChild(a)},s=function(a,b){a.appendChild(b)},t=function(a,b){a.parentNode.insertBefore(b,a)},u=function(b){var c=a.Promise||a.ES6Promise.Promise;return new c(function(a,c){$.ajax({url:b}).done(function(b){a(b)}).fail(function(a,b,d){c(d||{message:b})})})},v={},w=function(a,b,c){v[a]=v[a]||{},v[a][b]=c},x=function(a,b){return v[a]?v[a][b]:null},y=function(a,b){if(a){var c=a.split(" ");c.forEach(function(a){a=a.trim(),a&&"$"===a.charAt(0)&&(a="bs-style-"+a.substring(1)),b.push(a)})}},z=function(a,b){a.textContent=b},A={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},B=function(a){return(a||"").replace(/[&<>"'\/]/g,function(a){return A[a]})};return c.render={register:w,get:x},c.utils={allocUuid:e,allocID:f,escapeHtml:B},c.drag={setData:h,getData:i},c.ipc={emit:j,listen:k,unlisten:l},c.dom={find:m,addClass:n,removeClass:o,hasClass:p,before:t,append:s,remove:q,detach:r,text:z},c.ajax={get:u},c.styles={parse:y},c}(this);this.Phoenix=Phoenix,function(a){var b={AuthoringMode:"Authoring Mode",SaveLayout:"Save",PanelTitle:"Panel title",Html:'<p class="text-primary text-center">Block Html</p>'};return a.locale=a.locale||{},a.locale.layouts=a.locale.layouts||b,a}(Phoenix),function(a){var b=a.locale.layouts,c=function(a,c,d,e){a.$id||(a.$id=d.allocID()),c&&(a.$parentId=c.$id),a.$idDesign=a.$id,a.$idDrag=a.$id,a.$type=a.$type||"block",a.$items=a.$items||[],e&&(e[a.$id]=a),"panel"!=a.$type||a.$title?"html"!=a.$type||a.$html||(a.$html=b.Html):a.$title=b.PanelTitle},d=function(a,b,c,d){a.$id||(a.$id=c.allocID()),b&&(a.$parentId=b.$id),a.$idDrag=a.$id,d&&(d[a.$id]=a)},e=function(a){a.$items.length||a.$items.push({});var b=!1;if(a.$items.forEach(function(a){a.$type="column",a.$colSize||(b=!0)}),b){var c=Math.max(1,Math.floor(12/a.$items.length));a.$items.forEach(function(a){a.$colSize=c})}},f=function(a){if("row"===a.$type||"accordion"===a.$type||"html"===a.$type)return!1;if(a.$items.length>0){var b=a.$items[0];if(!b.$items)return!1}return!0},g=function(a){return"panel"==a.$type},h=function(a){return g(a)},i=function(a){var b=!0;return a.$items.length&&g(a)?(a.$items.forEach(function(a){b&&(b=!h(a))}),b):b},j=function(a){if(a.$type&&!a.$items&&(a.$items=[]),"row"===a.$type||"accordion"===a.$type||"html"===a.$type)return!1;if(a.$items.length>0){var b=a.$items[0];if(b.$type||b.$items)return!1}return!0},k=function(b,c){a.styles.parse(b.$style,c)},l=function(a,b,c){var d,e=[];switch(a.$type){case"block":e.push("container-fluid"),d=f(a),d&&((c.design||i(a))&&e.push("no-x-padding"),c.design&&e.push("drop-layouts-zone")),j(a)&&c.design&&(e.push("drop-fields-zone"),d||e.push("no-x-padding")),c.design&&(e.push("design"),a.selected&&e.push("selected")),k(a,e);break;case"accordion":1==c.step&&(e.push("panel-group"),c.design&&(e.push("design"),a.selected&&e.push("selected")),k(a,e));break;case"row":1==c.step?(e.push("container-fluid"),c.design&&(e.push("design"),e.push("no-x-padding"),a.selected&&e.push("selected")),k(a,e)):2==c.step&&(e.push("row"),c.design&&e.push("design-table"));break;case"panel":1==c.step?(e.push("panel"),e.push("panel-default"),c.design&&(e.push("design"),a.selected&&e.push("selected"))):2==c.step&&(e.push("panel-body"),d=f(a),d&&((c.design||i(a))&&(e.push("no-x-padding"),e.push("no-y-padding")),c.design&&e.push("drop-layouts-zone")),j(a)&&c.design&&(e.push("drop-fields-zone"),d||e.push("no-x-padding")),k(a,e));break;case"column":1==c.step?(e.push(c.design?"col-xs-"+a.$colSize:"col-"+(a.$colType||"sm")+"-"+a.$colSize),e.push("no-x-padding"),c.design&&e.push("drop-layouts-zone")):2==c.step&&(e.push("container-fluid"),d=f(a),d&&((c.design||i(a))&&e.push("no-x-padding"),c.design&&e.push("drop-layouts-zone")),j(a)&&c.design&&(e.push("drop-fields-zone"),d||e.push("no-x-padding")),c.design&&(e.push("design col"),a.selected&&e.push("selected")),k(a,e));break;case"html":c.design&&(e.push("design"),a.selected&&e.push("selected")),k(a,e)}return e},m=function(a,b,c,d){var e=l(b,c,d);a.className=e.join(" ")},n=function(a,b,c,d){var e=l(b,c,d);e.length&&(a.push(' class="'),a.push(e.join(" ")),a.push('"'))},o=function(a,b){a.push(' id="'),a.push(b.$id),a.push('"')},p=function(a,b,c){c&&(a.push(' data-level="'),a.push(b),a.push('"'))},q=function(a,b,c){if(a.push(' data-layout="'),a.push(c.$id),a.push('"'),b>1){var d=c["$idStep"+b];d&&(a.push(' id="'),a.push(d),a.push('"'))}},r=function(a,b,c,d,e,f,g){a.push("<div"),g&&a.push(' draggable="true"'),n(a,b,c,{design:g,step:1}),q(a,1,b),o(a,b),a.push(">"),a.push('<div class="panel-heading"'),a.push(">"),a.push('<h4 class="panel-title"'),a.push(">"),a.push(f.escapeHtml(b.$title)),a.push("</h4></div>"),b.$idStep2=b.$id+"_s2",b.$idDesign=b.$idStep2,a.push("<div"),n(a,b,c,{design:g,step:2}),q(a,2,b),p(a,2,g),a.push(">")},s=function(a,b){a.push("</div>"),b.$footer&&(a.push('<div class="panel-footer">'),a.push(b.$footer),a.push("</div>")),a.push("</div>")},t=function(a,b,c,d,e,f,g){a.push("<div"),g&&a.push(' draggable="true"'),n(a,b,c,{design:g,step:1}),q(a,1,b),o(a,b),p(a,1,g),a.push(">")},u=function(a){a.push("</div>")},v=function(a,b,c,d,e,f,g){a.push("<div"),g&&a.push(' draggable="true"'),n(a,b,c,{design:g,step:1}),q(a,1,b),o(a,b),p(a,1,g),a.push(">"),b.$html&&a.push(b.$html)},w=function(a){a.push("</div>")},x=function(a,b,c,d,f,g,h){a.push("<div"),h&&a.push(' draggable="true"'),n(a,b,c,{design:h,step:1}),o(a,b),q(a,1,b),p(a,1,h),a.push(">"),b.$idStep2=b.$id+"_s2",a.push("<div"),n(a,b,c,{design:h,step:2}),q(a,2,b),p(a,2,h),a.push(">"),e(b)},y=function(a){a.push("</div></div>")},z=function(a,b,c,d,e,f,g){a.push("<div"),n(a,b,c,{design:g,step:1}),q(a,1,b),o(a,b),p(a,1,g),a.push(">"),a.push("<div"),n(a,b,c,{design:g,step:2}),g&&a.push(' draggable="true"'),b.$idDesign=b.$id+"_design",b.$idDrag=b.$idDesign,b.$idStep2=b.$idDesign,q(a,2,b),p(a,2,g),a.push(">")},A=function(a){a.push("</div></div>")},B=function(a,b,c,d){if(a){if(d&&!a.$type&&!a.$items)return void c(a,b,!1,!0);c(a,b,!0,!0),j(a)?a.$items&&a.$items.forEach(function(b){c(b,a,!1,!0)}):a.$items&&a.$items.forEach(function(b){B(b,a,c,!1)}),c(a,b,!0,!1)}},C=function(a,b,c,d,e){a.push('<div class="bs-island'+(e.design?" design":"")+(b.$config?" bs-widget":" bs-field")+(b.selected?' selected"':'"')),e.design&&a.push(' draggable="true"'),a.push(' data-render="'+b.$id+'"'),a.push(' id="'+b.$id+'"'),a.push("></div>")},D=function(a,b){a.push('<div id="'+b.$id+'"></div>')},E=function(b,c,d,e,f,g){var h=a.render.get(g.context,"widget")||D,i=a.render.get(g.context,"field")||C;B(b,null,function(a,b,j,k){if(j){var l=t,m=u;switch(a.$type){case"row":l=x,m=y;break;case"column":l=z,m=A;break;case"panel":l=r,m=s;break;case"html":l=v,m=w}k?l(d,a,b,c,e,f,g.design):m(d,a,b,c,e,f,g.design)}else a.$config?h(d,a,b,c,g):i(d,a,b,c,g)},!0)},F=function(a){var c=['<div class="checkbox">',"    <label>",'      <input type="checkbox"'+(a?' checked="true"':"")+">",b.AuthoringMode,"    </label>","</div>"];return c.join("")},G=function(a,b,c){if(a.$type)return c=parseInt(c||"1",10),b&&a?"column"==b.$type&&"1"==c?b==a:"column"==a.$type?!1:!0:!1;if(a.$bind||a.$config){var d=b.$items.length;if(!d)return!0;for(var e=a.$bind?"$bind":"$config";d--;)if(!b.$items[d][e])return!1;return!0}return!1},H=function(a,b){return"column"==a.$type&&1==b?!1:!0};a.layout=a.layout||{};var I=a.layout;return I.utils=I.utils||{},I.utils.check=function(b,e,f,g){B(b,e,function(b,e,h,i){i&&(h?c(b,e,a.utils,f):d(b,e,a.utils,g))},!0)},I.utils.clearMeta=function(a,c){B(a,null,function(d,e,f,g){f&&g&&(c&&delete d.$id,delete d.$idDesign,delete d.$idDrag,delete d.$parentId,delete d.$idStep2,"column"==d.$type?delete d.$type:"panel"==a.$type?a.$title==b.PanelTitle&&delete a.$title:"html"==a.$type&&a.$html==b.Html&&delete a.$html)},!0)},I.utils.clearMaps=function(a,b,c){B(a,null,function(a,d,e,f){f&&(e?delete b[a.$id]:delete c[a.$id])},!0)},I.utils.afterRemoveChild=function(a,b,c){if("row"==a.$type){a.$items.forEach(function(a){a.$type="column",delete a.$colSize});{!a.$items.length}e(a),a.$items.forEach(function(d){I.utils.check(d,a,b,c)})}},I.utils.canDropChild=G,I.utils.canSelect=H,I.utils.updateCssClass=m,I.authModeHtml=F,I.toHtml=function(b,c,d){var e=[];return E(b,c,e,a.locale,a.utils,d),e.join("")},a}(Phoenix),function(a,b){var c=a.layout,d=a.dom,e=function(a,b,d){for(var e,f,g=a.target,h=null;g;){var h=g.getAttribute("data-layout");if(h){if(e=parseInt(g.getAttribute("data-level")||"1",10),f=d.getLayoutById(h),f&&c.utils.canSelect(f,e)||(h=null),h)break}else if(h=g.getAttribute("data-render"))break;g=g==b?null:g.parentNode}return h},f=function(a,b){for(var c=a.target;c;){if(c.hasAttribute("data-remove"))return!0;c=c==b?null:c.parentNode}return!1},g=function(a){return a.originalEvent?a.originalEvent:a},h=function(a,d){if(!a)return null;var e,f,g,h;a.map&&(e=!0,f=a.map,a.map=null,g=a.fields,a.fields=null),d&&(h=a.$items,h&&(a.$items=[]));var i=b.extend(!0,{},a);return e&&(a.map=f,a.fields=g,delete i.fields,delete i.map),d&&(a.$items=h),i.$type&&(c.utils.clearMeta(i,!d),d&&delete i.$items),i},i=function(a,c,d){for(var e=[],f=a.childNodes,g=0,h=f.length;h>g;g++){var i=f[g],j=b(i).offset();e.push({top:j.top+(j.height>>1),ignore:i==c||i.hasAttribute("data-remove"),placeHolder:i==d})}return e},j=function(a,b){var c=0;if(a.length){for(var d=0,e=a.length;e>d;d++){var f=a[d];if(!f.ignore&&b<f.top)return d;c=d+1}return c}return c},k=function(a,b,c,d){for(var e=0,f=0,g=a.childNodes.length;g>f;f++){var h=a.childNodes[f];if(h==b)return e;h!=c&&(!d||h.hasAttribute("data-layout"))&&(d||h.hasAttribute("data-render"))&&e++}return 0},l=function(a,b,c,e,f,g){var h=function(a){e.parentNode&&d.remove(e),f.$type&&!a&&("column"==f.$type&&1==g?d.addClass(e,"col"):d.removeClass(e,"col"))};if(!b.length)return h(!1),d.append(a,e),!0;for(var i=-1,j=0,k=b.length;k>j;j++){var l=b[j];if(l.placeHolder){if(i=j,j==c||j==c-1)return!1}else if(l.ignore){if(j==c&&k>j+1&&b[j+1].placeHolder)return!1;if(j==c-1&&j>0&&b[j-1].placeHolder)return!1}}if(0>i||c>=b.length)h(i>=0),d.append(a,e);else{var m=a.childNodes[c];h(i>=0),d.before(m,e)}return!0},m=function(a,b,c,e,f){return c?(b&&d.remove(b),b=document.createElement("div"),b.className=a.className,d.addClass(b,"drop-target"),d.before(a,b),b):(b=n(b,!1,e,f),d.before(a,b),b)},n=function(a,b,c,e){return a&&d.remove(a),a=document.createElement("div"),a.className="container-fluid no-x-padding drop-layouts-zone drop-fields-zone design drop-target"+(c?" bs-island bs-field":"")+(e?" bs-island bs-widget":""),a},o=function(){var a=document.createElement("div");return a.className="bs-drag-image",document.body.appendChild(a),a},p=function(a){for(var b=a.length;b--;)for(var c=a[b],d=Object.keys(c),e=d.length;e--;){var f=c[d[e]];if(f.selected)return f}return null},q=function(a,b){if(a){var c=d.find(a.get(0),b.$idDrag);b.selected?d.addClass(c,"selected"):d.removeClass(c,"selected")}},r=function(c,e,f){if(e){var g=d.find(c,e.$idDrag);if(c!=g)if(e.selected){var i=b('<div class="bs-rt-button" data-remove="true"><span class="glyphicon glyphicon-remove-sign"></span></div>').get(0),j=g.childNodes;j.length?d.before(j[0],i):d.append(g,i)}else{var k=g.querySelector('div[data-remove="true"]');k&&d.remove(k)}}f&&a.ipc.emit("SelectedChanged",{type:e?e.$type?"layout":e.$config?"widget":"field":null,data:h(e,!0)})},s=function(a,b,c){c&&(a.off("click"),a.find('div[draggable="true"]').off("dragstart").add(a).off("dragend"),a.find('div[draggable="true"]').off("dragstart"),a.find(".drop-layouts-zone, .drop-fields-zone").add(a).off("dragover dragenter drop"))},t=function(a){a.find('input[type="checkbox"]').off("click")},u=function(a,b){a.find('input[type="checkbox"]').on("click",function(){b.setDesignMode(this.checked)})},v=function(a,b,e,f){var g=d.find(b,a.$id),h=a.$id!=a.$idStep2?d.find(b,a.$idStep2):null;c.utils.updateCssClass(g,a,e.getLayoutById(a.$parentId),{design:f,step:1}),h&&c.utils.updateCssClass(h,a,e.getLayoutById(a.$parentId),{design:f,step:2})},w=function(b,h,p){if(p){var q,r,t,u,x,y=function(){q&&(d.removeClass(q,"bs-none"),q=null),u&&(d.remove(u),u=null),r&&(d.remove(r),r=null),x=null,t=!1,a.drag.setData(null)},z=function(a){var c=b.get(0);if(a){if(a.data==a.dst)return;var e,f,g,i,j=a.dst,k=a.data,l=d.find(c,k.$id),m=d.find(c,j.$idDesign);if(k.$parentId==j.$id){if(g=a.dst,f=g.$items.indexOf(k),e=a.indexInParent,e==f)return}else g=a.isNew?null:h.getLayoutById(k.$parentId),f=g?g.$items.indexOf(k):-1,e=a.indexInParent;if(k.$parentId=j.$id,f>=0&&g.$items.splice(f,1),j.$items.splice(e,0,k),!a.isNew){f>=0&&(l=d.detach(l)),e==j.$items.length-1?d.append(m,l):(i=d.find(c,j.$items[e+1].$id),d.before(i,l));var n=[g];return a.isLayout&&n.push(k),j!=g&&n.push(j),s(b,h,p),w(b,h,p),void n.forEach(function(a){v(a,c,h,p)})}h.check(k,j),h.render()}};b.on("click",function(a){var c=e(a,b.get(0),h);return f(a,b.get(0))?void h.removeChild(c):void h.select(c)}),b.find('div[draggable="true"]').on("dragstart",function(c){c.stopPropagation();var e=!1,f=!0,i=!1,j=h.getLayoutById(this.getAttribute("data-layout"));if(j||(j=h.getFieldById(this.getAttribute("data-render")),i=null!=j.$config,e=!i,f=!1),!j)return c.preventDefault(),!1;var k=g(c).dataTransfer;k.effectAllowed="move",k.setData("Text","data"),f&&k.setDragImage&&(r=o(!0),k.setDragImage(r,0,0)),a.drag.setData({data:j,isLayout:f,isField:e,isWidget:i,isNew:!1}),q=d.find(b.get(0),j.$idDrag),t=!0}).add(b).on("dragend",function(a){return a.preventDefault(),a.stopPropagation(),y(),!1}),b.find(".drop-layouts-zone, .drop-fields-zone").add(b).on("dragover dragenter drop",function(b){var e=this,f=a.drag.getData(),o=g(b),p=o.dataTransfer;if(b.stopPropagation(),!f||!f.isLayout&&!d.hasClass(e,"drop-fields-zone")||f.isLayout&&!d.hasClass(e,"drop-layouts-zone"))return p.effectAllowed="none",!0;if("drop"==b.type){b.preventDefault();var r=h.getLayoutById(e.getAttribute("data-layout")),s=e.getAttribute("data-level");return r?(f=a.drag.getData(),f.dst=r,f.dstLevel=s,f.indexInParent=k(e,u,q,f.isLayout),a.drag.setData(f),y(),z(f),!1):(y(),!1)}if(p.getData("Text"),t){if(!q)return;if(t=!1,!f.isNew)return u=m(q,u,f.isLayout,f.isField,f.isWidget),d.addClass(q,"bs-none"),b.preventDefault(),!1}var v=h.getLayoutById(e.getAttribute("data-layout")),w=e.getAttribute("data-level");if(!u){if(!f.isNew)return!0;if(!c.utils.canDropChild(f.data,v,w))return p.effectAllowed="none",!0;x=i(e,q,u);var A=j(x,o.pageY);return u=n(u,f.isLayout,f.isField,f.isWidget),l(e,x,A,u,v,w),x=null,b.preventDefault(),!1}if("dragenter"==b.type&&(x=null),q==e)return p.effectAllowed="none",!0;if(!c.utils.canDropChild(f.data,v,w))return p.effectAllowed="none",!0;x||(x=i(e,q,u));var B=j(x,o.pageY);return l(e,x,B,u,v,w)&&(x=null),b.preventDefault(),!1})}},x=function(b,d){this.$element=null,this.$check=null,this.$content=null,this.options=d||{},this.options.context=this.options.context||"javascript",this.map={},this.mapFields={},b=b||{},c.utils.check(b,null,this.map,this.mapFields),this.data=b,b.map=this.map,b.fields=this.mapFields,this.children={},a.ipc.listen("onToolBoxDragend",function(){this.$element&&this.$element.trigger("dragend")},this)},y={_renderLayout:function(a){var d=this,e=b(c.toHtml(a,null,{design:d.options.design,context:d.options.context}));return d._renderChildren(e),e},render:function(a){var d=this;if(d.$content?(d.$element&&(d._clearChildren(),s(d.$element,d,!0),d.options.beforeRemove&&d.options.beforeRemove(d.$element),d.$element.remove(),d.$element=null),d.$check&&(t(d.$check),d.$check.remove(),d.$check=null)):d.$content=b("<div></div>"),d.options.showPreview&&!d.$check&&(d.$check=b(c.authModeHtml(d.options.design)),d.$content.append(d.$check),u(d.$check,d,d.options.design)),!d.$element){d.$element=d._renderLayout(d.data),d.options.beforeAdd&&d.options.beforeAdd(d.$element),d.$content.append(d.$element),w(d.$element,d,d.options.design);var e=p([d.map,d.mapFields]);d.options.design&&r(d.$element.get(0),e,!0)}return a&&(d.options.replaceParent?a.replaceWith(d.$content):a.append(d.$content)),d.$content},_renderChildren:function(c){var e=this,f=c.get(0),g=a.render.get(e.options.context,"widget.control"),h=a.render.get(e.options.context,"field.control");(g||h)&&Object.keys(e.mapFields).forEach(function(a){var c=e.mapFields[a],i=c.$config?g:h;if(i){var j=new i(c,{context:e.options.context,design:e.options.design,replaceParent:!0});j.render(b(d.find(f,c.$id))),e.children[a]=j}})},_clearChildren:function(){var a=this,b=a.children;a.children={},Object.keys(b).forEach(function(a){b[a].destroy()})},destroy:function(){var b=this;b._clearChildren(),b.$element&&(s(b.$element,b,b.options.design),b.$element=null),b.$check&&(t(b.$check),b.$check=null),a.ipc.unlisten(b)},check:function(a,b){c.utils.check(a,b,this.map,this.mapFields)},toString:function(a){var b=h(a||this.data,!1);return JSON.stringify(b,2)},removeChild:function(a){var b=this;if(a&&b.options.design){var d=b.map[a]||b.mapFields[a];if(d){var e=b.map[d.$parentId];if(e){var f=e.$items.indexOf(d);e.$items.splice(f,1),c.utils.clearMaps(d,this.map,this.mapFields),c.utils.afterRemoveChild(e,this.map,this.mapFields),b.render()}}}},setDesignMode:function(a){var b=this;b.options.design!=a&&(b.options.design=a,b.render())},select:function(a){var b=this,c=b.$element;if(a&&b.options.design){var d=p([b.map,b.mapFields]);if(d&&(d.selected=!1,q(c,d),r(c.get(0),d,!1),d.$id==a))return void r(c.get(0),null,!0);var e=b.map[a]?b.map[a]:b.mapFields[a];e.selected=!0,q(c,e),r(c.get(0),e,!0)}},getLayoutById:function(a){if(!a)return null;var b=this;return b.map[a]},getFieldById:function(a){if(!a)return null;var b=this;return b.mapFields[a]}};b.extend(x.prototype,y),a.ui=a.ui||{},a.ui.Layout=x}(Phoenix,$),function(a){var b=function(a,b,c,d){a.$id=d.allocID(),b&&(a.$parentId=b.$id),a.$items&&(a.$contentId=d.allocUuid()),c&&(c[a.$id]=a)},c=function(a,b){a.push('<div class="panel-group" id="'+b.$id+'">')},d=function(a){a.push("</div>")},e=function(a,b,c){a.push('<div class="panel panel-default" id="'+b.$id+'">'),a.push('<div class="panel-heading">'),a.push('<h3 class="panel-title">'),a.push('<a data-toggle="collapse" draggable="false" data-parent="#'+c.$id+'" href="#'+c.$contentId+'"><span class="glyphicon glyphicon-folder-close bs-icon-space">'),a.push("</span>"),a.push(b.$title),a.push("</a></h3></div>"),a.push('<div id="'+c.$contentId+'" class="panel-collapse collapse in">'),a.push(' <ul class="list-group">')},f=function(a){a.push("</ul></div></div>")},g=function(a,b){a.push('<li draggable="true" class="list-group-item bs-cursor-p" data-toolbox="'+b.$id+'" id="'+b.$id+'">'),a.push('<span class="glyphicon glyphicon-flash text-success bs-icon-space"></span>'),a.push(b.$title),a.push("</li>")},h=function(){},i=function(a,b,c){a&&(c(a,b,!0),a.$items&&a.$items.forEach(function(b){i(b,a,c)}),c(a,b,!1))},j=function(a,b,j){i(a,b,function(a,b,i){var k=g,l=h;switch(a.$type){case"groups":k=c,l=d;break;case"group":k=e,l=f;break;default:k=g,l=h}i?k(j,a,b):l(j,a,b)})};a.toolBox=a.toolBox||{};var k=a.toolBox;return k.utils=k.utils||{},k.utils.check=function(c,d){i(c,null,function(c,e,f){f&&b(c,e,d,a.utils)})},k.toHtml=function(b,c){var d=[];return j(b,c,d,a.locale,a.utils),d.join("")},a}(Phoenix),function(a,b){var c=a.toolBox,d=function(c,d){c.find('li[draggable="true"]').on("dragstart",function(c){c.stopPropagation();var e=d.getItemById(b(this).attr("data-toolbox"));if(!e||!e.data)return c.preventDefault(),!1;var f=c.originalEvent?c.originalEvent.dataTransfer:c.dataTransfer;f.effectAllowed="move",f.setData("Text","Data");var g={isNew:!0,data:b.extend(!0,{},e.data.data)};switch(e.data.$type){case"layout":g.isLayout=!0;break;case"field":g.isField=!0;break;case"widget":g.isWidget=!0}a.drag.setData(g)}).on("dragend",function(b){return a.ipc.emit("ToolBoxDragend"),a.drag.setData(null),b.preventDefault(),b.stopPropagation(),!1})},e=function(a){a.find('li[draggable="true"]').off("dragstart dragend")},f=function(a){this.$element=null,this.map={},c.utils.check(a,this.map),this.data=a},g={renderToolBox:function(a,d){return b(c.toHtml(a,d))},render:function(a){var b=this;b.$element||(b.$element=b.renderToolBox(b.data),a&&a.append(b.$element),d(b.$element,b))},_destroy:function(){var a=this;a.$element&&(e(a.$element,a),a.$element=null)},getItemById:function(a){if(!a)return null;var b=this;return b.map[a]}};b.extend(f.prototype,g),a.ui=a.ui||{},a.ui.ToolBox=f}(Phoenix,$),function(a){var b=function(b,c){var d=b.$config,e=["bs-island bs-widget"];return a.styles.parse(d.$style,e),d.$border&&e.push("border"),c.design&&e.push("design"),b.$selected&&e.push("selected"),e.join(" ")},c=function(c,e,f){c.push('<div class="'),c.push(b(e,f)),c.push('"'),f.design&&c.push(' draggable="true"'),c.push(' data-render="'+e.$id+'"'),c.push(' id="'+e.$id+'"'),c.push(">"),d(c,e.$id,e.$config,f);var g=a.render.get(f.context,"widget.content");g&&g(c,e.$config,f)},d=function(b,c,d){b.push('<h4 class="bs-widget-title" id="'+c+'_title">'),b.push(a.utils.escapeHtml(d.$title)),b.push("</h4>")},e=function(a){a.push("</div>")},f=function(a,b,d,f,g){c(a,b,g),e(a)};return a.widget={toHtml:function(a,b,c,d){var e=[];return f(e,a,c,d,b),e.join("")}},a}(Phoenix),function(a,b){var c=function(b,c){this.item=b||{},this.item.$id||(this.item.$id=a.utils.allocID()),this.data=b.$config||{},b.$config.data=b.$config.data||{},this.props={},this.props.data=b.$config.data,this.options=c||{},this.contentRender=null,this._defineProps()},d={_dp:function(a){var b=this;Object.defineProperty(b.props,a,{get:function(){return b.data[a]},set:function(c){c!=b.data[a]&&(b.data[a]=c,b._notifyChange(a))},enumerable:!0})},_defineProps:function(){var a=this;a._dp("$title"),a._dp("$border")},_notifyChange:function(a){var b=this;switch(a){case"$title":b._updateTitle();break;case"$border":case"$titleIsHidden":b._updateCssClass()}},_updateTitle:function(){var b=this;if(b.$element){var c=a.dom.find(b.$element.get(0),b.item.$id+"_title");c&&a.dom.text(c,this.data.$title)}},_updateCssClass:function(){console.log("_updateCssClass")},render:function(d){var e=this;if(!e.$element){e.$element=b(a.widget.toHtml(e.item,e.options));var f=a.render.get(this.options.context,"widget.content.control."+e.data.$type,c);f&&(e.contentRender=new f(e.props,{context:e.options.context,replaceParent:!1}),e.contentRender.render(e.$element))}return d&&(e.options.beforeAdd&&e.options.beforeAdd(e.$element),e.options.replaceParent?d.replaceWith(e.$element):d.append(e.$element)),e.$element},destroy:function(){var a=this;a.contentRender&&(a.contentRender.destroy(),a.contentRender=null),a.$element=null}};b.extend(c.prototype,d),a.ui=a.ui||{},a.ui.Widget=c,a.render.register("javascript","widget.control",c)}(Phoenix,$);