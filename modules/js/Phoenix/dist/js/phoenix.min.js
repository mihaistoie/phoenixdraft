"use strict";var Phoenix=function(){var a,b={},c=function(){function a(a){var b=(Math.random().toString(16)+"000000000").substr(2,8);return a?"-"+b.substr(0,4)+"-"+b.substr(4,4):b}return a()+a(!0)+a(!0)+a()},d={},e=function(b){a=b},f=function(){return a},g=function(a){var b="on"+a,c=d[b];c&&c.forEach(function(a){a.handler.bind(a.listener)()})},h=function(a,b,c){d[a]=d[a]||[];var e=d[a];e.push({listener:b,handler:c})},i=function(a,b){function c(b){if(b)for(var c=b.length;c--;){var d=b[c];d.listener==a&&b.splice(c,1)}}b?c(d[b]):Object.keys(d).forEach(function(a){c(d[a])})};return b.utils={allocUuid:c,setDragData:e,getDragData:f,emit:g,addListener:h,rmvListener:i},b}();window.Phoenix=Phoenix,function(a){var b={AuthoringMode:"Authoring Mode",PanelTitle:"Panel title",Html:'<p class="text-primary text-center">Block Html</p>'};return a.locale=a.locale||{},a.locale.layouts=a.locale.layouts||b,a}(Phoenix),function(a){var b=a.locale.layouts,c=function(a,c,d,e){console.log(a),a.$id||(a.$id=d.allocUuid()),c&&(a.$parentId=c.$id),a.$idDesign=a.$id,a.$idDrag=a.$id,a.$type=a.$type||"block",a.$items=a.$items||[],e&&(e[a.$id]=a),"panel"!=a.$type||a.$title?"html"!=a.$type||a.$html||(a.$html=b.Html):a.$title=b.PanelTitle},d=function(a){a.$items.length||a.$items.push({});var b=!1;if(a.$items.forEach(function(a){a.$type="column",a.$colSize||(b=!0)}),b){var c=Math.max(1,Math.floor(12/a.$items.length));a.$items.forEach(function(a){a.$colSize=c})}},e=function(a){if("row"===a.$type||"accordion"===a.$type||"html"===a.$type)return!1;if(a.$items.length>0){var b=a.$items[0];if(!b.$items)return!1}return!0},f=function(a){return"panel"==a.$type},g=function(a){var b=!0;return a.$items.length?(a.$items.forEach(function(a){b&&(b=!f(a))}),b):b},h=function(a){if(a.$type&&!a.$items&&(a.$items=[]),"row"===a.$type||"accordion"===a.$type||"html"===a.$type)return!1;if(a.$items.length>0){var b=a.$items[0];if(b.$type||a.$items)return!1}return!0},i=function(a,b){if(a.$style){var c=a.$style.split(" ");c.forEach(function(a){a=a.trim(),a&&"$"===a.charAt(0)&&(a="bs-style-"+a.substring(1)),b.push(a)})}},j=function(a,b,c){var d=[];switch(a.$type){case"block":d.push("container-fluid"),e(a)&&((c.design||g(a))&&d.push("no-x-padding"),c.design&&d.push("drop-layouts-zone")),h(a)&&c.design&&d.push("drop-fields-zone"),c.design&&(d.push("design"),a.selected&&d.push("selected")),i(a,d);break;case"accordion":1==c.step&&(d.push("panel-group"),c.design&&(d.push("design"),a.selected&&d.push("selected")),i(a,d));break;case"row":1==c.step?(d.push("container-fluid"),c.design&&(d.push("design"),d.push("no-x-padding"),a.selected&&d.push("selected")),i(a,d)):2==c.step&&(d.push("row"),c.design&&d.push("design-table"));break;case"panel":1==c.step?(d.push("panel"),d.push("panel-default"),c.design&&(d.push("design"),a.selected&&d.push("selected"))):2==c.step&&(d.push("panel-body"),e(a)&&((c.design||g(a))&&(d.push("no-x-padding"),d.push("no-y-padding")),c.design&&d.push("drop-layouts-zone")),h(a)&&c.design&&d.push("drop-fields-zone"),i(a,d));break;case"column":1==c.step?(d.push(c.design?"col-xs-"+a.$colSize:"col-"+(a.$colType||"sm")+"-"+a.$colSize),d.push("no-x-padding"),c.design&&d.push("drop-layouts-zone")):2==c.step&&(d.push("container-fluid"),e(a)&&((c.design||g(a))&&d.push("no-x-padding"),c.design&&d.push("drop-layouts-zone")),h(a)&&c.design&&d.push("drop-fields-zone"),c.design&&(d.push("design col"),a.selected&&d.push("selected")),i(a,d));break;case"html":c.design&&(d.push("design"),a.selected&&d.push("selected")),i(a,d)}return d},k=function(a,b,c,d){var e=j(b,c,d);a.attr("class",e.join(" "))},l=function(a,b,c,d){var e=j(b,c,d);e.length&&(a.push(' class="'),a.push(e.join(" ")),a.push('"'))},m=function(a,b){a.push(' id="'),a.push(b.$id),a.push('"')},n=function(a,b,c){c&&(a.push(' data-level="'),a.push(b),a.push('"'))},o=function(a,b,c){if(a.push(' data-layout="'),a.push(c.$id),a.push('"'),b>1){var d=c["$idStep"+b];d&&(a.push(' id="'),a.push(d),a.push('"'))}},p=function(a,b,c,d,e,f,g,h){a.push("<div"),h&&a.push(' draggable="true"'),l(a,b,c,{design:h,step:1}),o(a,1,b),m(a,b),a.push(">"),a.push('<div class="panel-heading"'),a.push(">"),a.push('<h4 class="panel-title"'),a.push(">"),a.push(b.$title),a.push("</h4></div>"),b.$idStep2=b.$id+"_s2",b.$idDesign=b.$idStep2,a.push("<div"),l(a,b,c,{design:h,step:2}),o(a,2,b),n(a,2,h),a.push(">")},q=function(a,b){a.push("</div>"),b.$footer&&(a.push('<div class="panel-footer">'),a.push(b.$footer),a.push("</div>")),a.push("</div>")},r=function(a,b,c,d,e,f,g,h){a.push("<div"),h&&a.push(' draggable="true"'),l(a,b,c,{design:h,step:1}),o(a,1,b),m(a,b),n(a,1,h),a.push(">")},s=function(a){a.push("</div>")},t=function(a,b,c,d,e,f,g,h){a.push("<div"),h&&a.push(' draggable="true"'),l(a,b,c,{design:h,step:1}),o(a,1,b),m(a,b),n(a,1,h),a.push(">"),b.$html&&a.push(b.$html)},u=function(a){a.push("</div>")},v=function(a,b,c,e,f,g,h,i){a.push("<div"),i&&a.push(' draggable="true"'),l(a,b,c,{design:i,step:1}),m(a,b),o(a,1,b),n(a,1,i),a.push(">"),b.$idStep2=b.$id+"_s2",a.push("<div"),l(a,b,c,{design:i,step:2}),o(a,2,b),n(a,2,i),a.push(">"),d(b)},w=function(a){a.push("</div></div>")},x=function(a,b,c,d,e,f,g,h){a.push("<div"),l(a,b,c,{design:h,step:1}),o(a,1,b),m(a,b),n(a,1,h),a.push(">"),a.push("<div"),l(a,b,c,{design:h,step:2}),h&&a.push(' draggable="true"'),b.$idDesign=b.$id+"_design",b.$idDrag=b.$idDesign,b.$idStep2=b.$idDesign,o(a,2,b),n(a,2,h),a.push(">")},y=function(a){a.push("</div></div>")},z=function(a,b,c){a&&(c(a,b,!0),h(a)||a.$items&&a.$items.forEach(function(b){z(b,a,c)}),c(a,b,!1))},A=function(a,b,c,d,e,f,g){z(a,null,function(a,h,i){var j=r,k=s;switch(a.$type){case"row":j=v,k=w;break;case"column":j=x,k=y;break;case"panel":j=p,k=q;break;case"html":j=t,k=u}i?j(d,a,h,b,c,e,f,g.design):k(d,a,h,b,c,e,f,g.design)})},B=function(a){var c=['<div class="checkbox">',"    <label>",'      <input type="checkbox"'+(a?' checked="true"':"")+">",b.AuthoringMode,"    </label>","</div>"];return c.join("")},C=function(a,b,c){return c=parseInt(c||"1",10),b&&a?"column"==b.$type&&"1"==c?b==a:"column"==a.$type?!1:(console.log("_canDropChild"),!0):!1},D=function(a,b){return console.log(a.$type+"  "+b),"column"==a.$type&&1==b?!1:!0};a.layout=a.layout||{};var E=a.layout;return E.utils=E.utils||{},E.utils.check=function(b,d,e){z(b,e,function(b,e,f){f&&c(b,e,a.utils,d)})},E.utils.clearMeta=function(a){z(a,null,function(c,d,e){e&&(delete c.$id,delete c.$idDesign,delete c.$idDrag,delete c.$parentId,delete c.$idStep2,"column"==c.$type?delete c.$type:"panel"==a.$type?a.$title==b.PanelTitle&&delete a.$title:"html"==a.$type&&a.$html==b.Html&&delete a.$html)})},E.utils.afterRemoveChild=function(a,b){if("row"==a.$type){a.$items.forEach(function(a){a.$type="column",delete a.$colSize});{!a.$items.length}d(a),a.$items.forEach(function(c){E.utils.check(c,b,a)})}},E.utils.canDropChild=C,E.utils.canSelect=D,E.setClassName=k,E.authModeHtml=B,E.toHtml=function(b,c,d,e){var f=[];return A(b,c,d,f,a.locale,a.utils,e),f.join("")},a}(Phoenix),function(a,b){var c=a.layout,d=function(a,d,e){for(var f,g,h=b(a.target),i=null;h&&h.get(0);){var i=h.attr("data-layout");if(i&&(f=parseInt(h.attr("data-level")||"1",10),g=e.getLayoutById(i),g&&c.utils.canSelect(g,f)||(i=null),i))break;h=h.get(0)==d.get(0)?null:h.parent()}return i},e=function(a,c){for(var d=b(a.target);d&&d.get(0);){if(d.attr("data-remove"))return!0;d=d.get(0)==c.get(0)?null:d.parent()}return!1},f=function(a,c,d){for(var e=[],f=a.children(),g=0,h=f.length;h>g;g++){var i=f[g],j=b(i).offset();e.push({top:j.top+(j.height>>1),ignore:i==c||i.hasAttribute("data-remove"),placeHolder:i==d})}return e},g=function(a,b){var c=0;if(a.length){for(var d=0,e=a.length;e>d;d++){var f=a[d];if(!f.ignore&&b<f.top)return d;c=d+1}return c}return c},h=function(a,b,c){for(var d=0,e=0,f=a.childNodes.length;f>e;e++){var g=a.childNodes[e];if(g==b)return d;g!=c&&g.hasAttribute("data-layout")&&d++}return 0},i=function(a,c,d,e,f,g){var h=function(a){e.remove(),a||("column"==f.$type&&1==g?e.addClass("col"):e.removeClass("col"))};if(!c.length)return h(!1),a.append(e),!0;for(var i=-1,j=0,k=c.length;k>j;j++){var l=c[j];if(l.placeHolder){if(i=j,j==d||j==d-1)return!1}else if(l.ignore){if(j==d&&k>j+1&&c[j+1].placeHolder)return!1;if(j==d-1&&j>0&&c[j-1].placeHolder)return!1}}if(0>i||d>=c.length)h(i>=0),a.append(e);else{var m=b(a.get(0).childNodes[d]);h(i>=0),m.before(e)}return!0},j=function(a,c){return c&&c.remove(),c=b("<div></div>"),c.addClass(a.attr("class")),c.addClass("drop-target"),a.before(c),c},k=function(a){return a&&a.remove(),a=b("<div></div>"),a.addClass("container-fluid no-x-padding drop-layouts-zone drop-fields-zone design drop-target"),a},l=function(){var a=b('<div class="bs-drag-image"></div>');return document.body.appendChild(a.get(0)),a},m=function(a){for(var b=Object.keys(a),c=b.length;c--;)if(a[b[c]].selected)return b[c];return null},n=function(a,c){return b("#"+c)},o=function(a,b){if(a){var c=n(a,b.$idDrag);b.selected?c.addClass("selected"):c.removeClass("selected")}},p=function(c,d,e){if(d){var f=n(c,d.$idDrag);if(c.get(0)!=f.get(0))if(d.selected){var g=b('<div class="bs-rt-button" data-remove="true"><span class="glyphicon glyphicon-remove-sign"></span></div>'),h=f.children();h.length?b(h.get(0)).before(g):f.append(g)}else f.children('div[data-remove="true"]').remove()}e&&a.utils.emit("SelectedChanged",{type:"layout",data:d})},q=function(a,b,c){c&&(a.off("click"),a.find('div[draggable="true"]').off("dragstart").add(a).off("dragend"),a.find('div[draggable="true"]').off("dragstart"),a.find(".drop-layouts-zone").add(a).off("dragover dragenter drop"))},r=function(a){a.find('input[type="checkbox"]').off("click")},s=function(a,b){a.find('input[type="checkbox"]').on("click",function(){b.setDesignMode(this.checked)})},t=function(a,b,d,e){var f=n(b,a.$id),g=a.$id!=a.$idStep2?n(b,a.$idStep2):null;c.setClassName(f,a,d.getLayoutById(a.$parentId),{design:e,step:1}),g&&c.setClassName(g,a,d.getLayoutById(a.$parentId),{design:e,step:2})},u=function(m,o,p){if(p){var r,s,v,w,x,y=function(){r&&(r.removeClass("bs-none"),r=null),w&&(w.remove(),w=null),s&&(s.remove(),s=null),x=null,v=!1,a.utils.setDragData(null)},z=function(a){if(console.log("Drop event"),a&&a.isLayout){if(a.layout==a.dst)return;var b,c,d,e,f=a.dst,g=a.layout,h=n(m,g.$id),i=n(m,f.$idDesign);if(g.$parentId==f){if(d=a.dst,c=d.$items.indexOf(g),b=a.indexInParent,b==c)return}else d=a.isNew?null:o.getLayoutById(g.$parentId),c=d?d.$items.indexOf(g):-1,b=a.indexInParent;if(g.$parentId=f.$id,c>=0&&d.$items.splice(c,1),f.$items.splice(b,0,g),!a.isNew){c>=0&&h.detach(),b==f.$items.length-1?i.append(h):(e=n(m,f.$items[b+1].$id),e.before(h));var j=[g,d];return f!=d&&j.push(f),q(m,o,p),u(m,o,p),void j.forEach(function(a){t(a,m,o,p)})}o.check(g,f),o.render(null,!0)}};m.on("click",function(a){var b=d(a,m,o);return e(a,m)?void o.removeLayout(b):void o.select(b)}),m.find('div[draggable="true"]').on("dragstart",function(c){c.stopPropagation();var d=o.getLayoutById(b(this).attr("data-layout"));if(!d)return c.preventDefault(),!1;var e=c.originalEvent?c.originalEvent.dataTransfer:c.dataTransfer;e.effectAllowed="move",e.setData("Text","data"),e.setDragImage&&(s=l(!0),e.setDragImage(s.get(0),0,0)),a.utils.setDragData({layout:d,isLayout:!0,isNew:!1}),r=n(m,d.$idDrag),v=!0}).add(m).on("dragend",function(a){return console.log("dragend"),a.preventDefault(),a.stopPropagation(),y(),!1}),m.find(".drop-layouts-zone").add(m).on("dragover dragenter drop",function(d){var e,l=b(this),m=d.originalEvent?d.originalEvent:d;if(d.stopPropagation(),"drop"==d.type){console.log("drop"),d.preventDefault();var n=o.getLayoutById(l.attr("data-layout")),p=l.attr("data-level");return n?(e=a.utils.getDragData(),e.dst=n,e.dstLevel=p,e.indexInParent=h(l.get(0),w.get(0),r?r.get(0):null),a.utils.setDragData(e),y(),z(e),!1):(y(),!1)}{var q=m.dataTransfer;q.getData("Text")}if(e=a.utils.getDragData(),v){if(!r)return;if(v=!1,!e.isNew)return w=j(r,w),r.addClass("bs-none"),d.preventDefault(),!1}if(!w){if(!e.isNew)return!0;if(e.isLayout){x=f(l,r?r.get(0):null,w?w.get(0):0);var s=g(x,m.pageY);w=k(w);var t=o.getLayoutById(l.attr("data-layout")),u=l.attr("data-level");return i(l,x,s,w,t,u),x=null,d.preventDefault(),!1}}if(e.isLayout){if("dragenter"==d.type&&(x=null),r&&r.get(0)==l.get(0))return q.effectAllowed="none",!0;var A=o.getLayoutById(l.attr("data-layout")),B=l.attr("data-level");if(!c.utils.canDropChild(e.layout,A,l.attr("data-level")))return q.effectAllowed="none",!0;x||(x=f(l,r?r.get(0):null,w?w.get(0):0));var C=g(x,m.pageY);return i(l,x,C,w,A,B)&&(x=null),d.preventDefault(),!1}return d.preventDefault(),q.effectAllowed="none",!0})}},v=function(b){this.$element=null,this.design=!0,this.showPreview=!0,this.map={},c.utils.check(b,this.map),this.data=b,a.utils.addListener("onToolBoxDragend",this,function(){this.$element&&this.$element.trigger("dragend")})},w={renderLayout:function(a){var d=this;return b(c.toHtml(a,null,null,{design:d.design}))},render:function(a,d){var e=this;if(d&&e.$element&&(a=a||e.$element.parent(),q(e.$element,e,!0),e.$element.remove(),e.$element=null),d&&e.$check&&(r(e.$check),e.$check.remove(),e.$check=null),this.showPreview&&(e.$check=b(c.authModeHtml(this.design)),a&&a.append(e.$check),s(e.$check,e,e.design)),!e.$element){e.$element=e.renderLayout(e.data),a&&a.append(e.$element),u(e.$element,e,e.design);var f=m(e.map);e.design&&p(e.$element,e.map[f],!0)}},_destroy:function(){var b=this;b.$element&&(q(b.$element,b,b.design),b.$element=null),b.$check&&(r(b.$check),b.$check=null),a.utils.rmvListener(b)},check:function(a,b){c.utils.check(a,this.map,b)},toString:function(a){var d=b.extend(!0,{},JSON.parse(JSON.stringify(a||this.data)));return c.utils.clearMeta(d),JSON.stringify(d,2)},removeLayout:function(a){var b=this;if(a&&b.design&&b.map[a]){var d=b.map[a];if(d){var e=b.map[d.$parentId];if(e){var f=e.$items.indexOf(d);e.$items.splice(f,1),delete b.map[d.$id],c.utils.afterRemoveChild(e,this.map),b.render(null,!0)}}}},setDesignMode:function(a){var b=this;b.design!=a&&(b.design=a,b.render(null,!0))},select:function(a){var b=this,c=b.$element;if(a&&b.design&&b.map[a]){var d=m(b.map);if(d){var e=b.map[d];e.selected=!1,o(c,e),p(b.$element,e,!1)}if(d==a)return void p(b.$element,null,!0);var f=b.map[a];f.selected=!0,o(c,f),p(b.$element,f,!0)}},getLayoutById:function(a){if(!a)return null;var b=this;return b.map[a]}};b.extend(v.prototype,w),a.ui=a.ui||{},a.ui.Layout=v}(Phoenix,$),function(a){var b=function(a,b,c,d){a.$id=d.allocUuid(),b&&(a.$parentId=b.$id),a.$items&&(a.$contentId=d.allocUuid()),c&&(c[a.$id]=a)},c=function(a,b){a.push('<div class="panel-group" id="'+b.$id+'">')},d=function(a){a.push("</div>")},e=function(a,b,c){a.push('<div class="panel panel-default" id="'+b.$id+'">'),a.push('<div class="panel-heading">'),a.push('<h3 class="panel-title">'),a.push('<a data-toggle="collapse" draggable="false" data-parent="#'+c.$id+'" href="#'+c.$contentId+'"><span class="glyphicon glyphicon-folder-close bs-icon-space">'),a.push("</span>"),a.push(b.$title),a.push("</a></h3></div>"),a.push('<div id="'+c.$contentId+'" class="panel-collapse collapse in">'),a.push(' <ul class="list-group">')},f=function(a){a.push("</ul></div></div>")},g=function(a,b){a.push('<li draggable="true" class="list-group-item bs-cursor-p" data-toolbox="'+b.$id+'" id="'+b.$id+'">'),a.push('<span class="glyphicon glyphicon-flash text-success bs-icon-space"></span>'),a.push(b.$title),a.push("</li>")},h=function(){},i=function(a,b,c){a&&(c(a,b,!0),a.$items&&a.$items.forEach(function(b){i(b,a,c)}),c(a,b,!1))},j=function(a,b,j){i(a,b,function(a,b,i){var k=g,l=h;switch(a.$type){case"groups":k=c,l=d;break;case"group":k=e,l=f;break;default:k=g,l=h}i?k(j,a,b):l(j,a,b)})};a.toolBox=a.toolBox||{};var k=a.toolBox;return k.utils=k.utils||{},k.utils.check=function(c,d){i(c,null,function(c,e,f){f&&b(c,e,d,a.utils)})},k.toHtml=function(b,c){var d=[];return j(b,c,d,a.locale,a.utils),d.join("")},a}(Phoenix),function(a,b){var c=a.toolBox,d=function(c,d){c.find('li[draggable="true"]').on("dragstart",function(c){c.stopPropagation();var e=d.getItemById(b(this).attr("data-toolbox"));if(!e||!e.data)return c.preventDefault(),!1;var f=c.originalEvent?c.originalEvent.dataTransfer:c.dataTransfer;f.effectAllowed="move",f.setData("Text","Data"),a.utils.setDragData({isLayout:"layout"==e.data.$type,isNew:!0,layout:b.extend(!0,{},e.data.data)})}).on("dragend",function(b){return console.log("dragend - tool box"),a.utils.emit("ToolBoxDragend"),a.utils.setDragData(null),b.preventDefault(),b.stopPropagation(),!1})},e=function(a){a.find('li[draggable="true"]').off("dragstart dragend")},f=function(a){this.$element=null,this.map={},c.utils.check(a,this.map),this.data=a},g={renderToolBox:function(a,d){return b(c.toHtml(a,d))},render:function(a){var b=this;b.$element||(b.$element=b.renderToolBox(b.data),a&&a.append(b.$element),d(b.$element,b))},_destroy:function(){var a=this;a.$element&&(e(a.$element,a),a.$element=null)},getItemById:function(a){if(!a)return null;var b=this;return b.map[a]}};b.extend(f.prototype,g),a.ui=a.ui||{},a.ui.ToolBox=f}(Phoenix,$);